# Implementation Plan

- [ ] 1. Create database migrations
  - [ ] 1.1 Create quotations table migration
    - Create migration file with all columns: id, quotation_no, series, quotation_date, customer_name, discount_percent, remarks, terms, net_amount, status, created_by, updated_by, timestamps
    - Add unique index on quotation_no
    - _Requirements: 1.2, 6.1_
  - [ ] 1.2 Create quotation_items table migration
    - Create migration file with all columns: id, quotation_id, item_id, item_code, item_name, packing, company_name, location, qty, rate, mrp, amount, unit, row_order, timestamps
    - Add foreign key to quotations table
    - _Requirements: 2.1, 6.1_

- [ ] 2. Create Eloquent models
  - [ ] 2.1 Create Quotation model
    - Define fillable fields, casts, and relationships (items, creator, updater)
    - _Requirements: 6.1, 6.2_
  - [ ] 2.2 Create QuotationItem model
    - Define fillable fields, casts, and relationships (quotation, item)
    - _Requirements: 2.1, 6.1_
  - [ ]* 2.3 Write property test for quotation data round-trip
    - **Property 5: Quotation Data Round-Trip**
    - **Validates: Requirements 1.4, 4.2, 6.1, 6.2**

- [ ] 3. Create QuotationController with core methods
  - [ ] 3.1 Implement generateQuotationNo() method
    - Generate unique sequential quotation numbers with series prefix
    - _Requirements: 1.2_
  - [ ]* 3.2 Write property test for unique sequential quotation numbers
    - **Property 1: Unique Sequential Quotation Numbers**
    - **Validates: Requirements 1.2**
  - [ ] 3.3 Implement index() method
    - List all quotations with pagination
    - _Requirements: 4.1_
  - [ ] 3.4 Implement transaction() method
    - Show transaction form with items data
    - _Requirements: 1.1_
  - [ ] 3.5 Implement store() method
    - Save quotation header and items without batch modification
    - Use database transaction for atomicity
    - _Requirements: 1.2, 1.3, 1.4, 2.1, 6.1, 6.3_
  - [ ]* 3.6 Write property test for batch quantity invariant
    - **Property 2: Batch Quantity Invariant**
    - **Validates: Requirements 1.3**
  - [ ] 3.7 Implement getItems() method
    - Return items list for selection modal
    - _Requirements: 2.1_

- [ ] 4. Implement calculation logic
  - [ ] 4.1 Implement line item amount calculation in store/update
    - Calculate amount = qty × rate for each item
    - _Requirements: 2.2, 3.1_
  - [ ]* 4.2 Write property test for line item amount calculation
    - **Property 3: Line Item Amount Calculation**
    - **Validates: Requirements 2.1, 2.2**
  - [ ] 4.3 Implement net amount calculation with discount
    - Calculate net_amount = sum(amounts) × (1 - discount/100)
    - _Requirements: 3.1, 3.2_
  - [ ]* 4.4 Write property test for net amount calculation
    - **Property 4: Net Amount Calculation**
    - **Validates: Requirements 3.1, 3.2**

- [ ] 5. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [ ] 6. Create transaction view
  - [ ] 6.1 Create transaction.blade.php
    - Header section with date, customer name, discount %, remarks, terms
    - Items grid with Code, Item Name, Qty, Rate, MRP, Amount columns
    - Footer section with Pack, Unit, Cl.Qty, Comp, Lctn, Srlno
    - Summary section with Net amount
    - Action buttons: Save (End), Delete Item, Insert Item, Cancel Quotation
    - _Requirements: 1.1, 2.1, 2.3, 2.4, 2.5, 3.1, 3.3_
  - [ ] 6.2 Implement JavaScript for item grid management
    - Add row, delete row, select row functionality
    - Auto-calculate amounts on qty/rate change
    - Item selection modal
    - _Requirements: 2.2, 2.4, 2.5, 3.1_

- [ ] 7. Implement modification functionality
  - [ ] 7.1 Implement modification() method in controller
    - Show modification page with quotation list
    - _Requirements: 4.1_
  - [ ] 7.2 Implement getQuotations() method
    - Return quotations list for AJAX loading
    - _Requirements: 4.1_
  - [ ] 7.3 Implement edit() method
    - Load quotation with items for editing
    - _Requirements: 4.2_
  - [ ] 7.4 Implement update() method
    - Update quotation header and items, preserve quotation_no
    - _Requirements: 4.3_
  - [ ]* 7.5 Write property test for update preserves quotation number
    - **Property 6: Update Preserves Quotation Number**
    - **Validates: Requirements 4.3**
  - [ ] 7.6 Implement cancel() method
    - Set status to 'cancelled' without deleting record
    - _Requirements: 4.4_
  - [ ]* 7.7 Write property test for cancel sets status without deletion
    - **Property 7: Cancel Sets Status Without Deletion**
    - **Validates: Requirements 4.4**
  - [ ] 7.8 Create modification.blade.php
    - Load invoice modal, quotation form, update/cancel buttons
    - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [ ] 8. Create show and index views
  - [ ] 8.1 Create show.blade.php
    - Display quotation header and items in read-only format
    - Print button
    - _Requirements: 5.1, 5.2_
  - [ ] 8.2 Create index.blade.php
    - List quotations with search, pagination
    - Links to view, edit, cancel
    - _Requirements: 4.1_

- [ ] 9. Add routes
  - [ ] 9.1 Add quotation routes to web.php
    - Resource routes plus custom routes for transaction, modification, cancel, get-items, get-quotations
    - _Requirements: All_

- [ ] 10. Final Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.
